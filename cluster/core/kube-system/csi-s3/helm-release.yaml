---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: csi-s3
  namespace: kube-system
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://github.com/CloudVE/helm-charts/raw/master
      chart: csi-s3
      version: 0.31.3
      sourceRef:
        kind: HelmRepository
        name: cloudve-charts
        namespace: flux-system
      interval: 5m
  values:
    storageClass:
      mounter: geesefs
      singleBucket: ${SECRET_S3_BUCKET}
      mountOptions: >-
        --no-checksum --max-flushers 32 --max-parallel-parts 32 --part-sizes 25
        --read-ahead-large 20480 --dir-mode 0777 --file-mode 0666 --list-type 2
        --cache-file-mode 0666 --cache-to-disk-hits 0 --cache /tmp
      reclaimPolicy: Retain
    secret:
      accessKey: ${SECRET_S3_GATEWAY_ACCESS_KEY}
      secretKey: ${SECRET_S3_GATEWAY_SECRET_KEY}
      endpoint: https://${SECRET_S3_GATEWAY_SERVICE_ENDPOINT}
